
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>TanujaNikitha AI</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:Poppins;
  height:100vh;
  background:#f1f5f9;
  display:flex;
}

/* ---------- LOGIN ---------- */
#login{
  height:100vh;
  width:100%;
  display:flex;
  justify-content:center;
  align-items:center;
}
.login-box{
  background:#fff;
  padding:36px;
  width:320px;
  border-radius:16px;
  box-shadow:0 20px 40px rgba(0,0,0,.2);
  text-align:center;
}
.login-box input,
.login-box button{
  width:100%;
  padding:14px;
  margin-top:12px;
  border-radius:10px;
  border:1px solid #ccc;
}

/* ---------- CHAT ---------- */
#chat{
  display:none;
  height:100vh;
  width:100%;
}

/* ---------- SIDEBAR ---------- */
.sidebar{
  width:260px;
  background:#0f172a;
  color:#fff;
  padding:14px;
  display:flex;
  flex-direction:column;
}
.sidebar h3{margin-bottom:10px}

#history{
  flex:1;
  overflow-y:auto;
}
.history-item{
  background:rgba(255,255,255,.12);
  padding:8px;
  border-radius:8px;
  margin-bottom:6px;
  font-size:13px;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

.clear-btn{
  margin-top:10px;
  padding:10px;
  border:none;
  border-radius:8px;
  cursor:pointer;
}

/* ---------- MAIN CHAT ---------- */
.chat-app{
  flex:1;
  display:flex;
  flex-direction:column;
}

/* HEADER */
.header{
  height:50px;
  padding:0 14px;
  background:#2563eb;
  color:#fff;
  display:flex;
  align-items:center;
  justify-content:space-between;
}
.header-title{
  font-size:15px;
  font-weight:600;
}

/* SMALL LOGOUT */
.logout-btn{
  padding:4px 12px;
  font-size:12px;
  border-radius:6px;
  border:none;
  background:#1e40af;
  color:#fff;
  cursor:pointer;
}
.logout-btn:hover{background:#1e3a8a}

/* CHAT AREA */
#chat-box{
  flex:1;
  padding:16px;
  overflow-y:auto;
  display:flex;
  flex-direction:column;
  gap:10px;
}
.message{
  max-width:70%;
  padding:12px 16px;
  border-radius:16px;
  font-size:14px;
  line-height:1.4;
  white-space:pre-wrap;
}
.user{
  margin-left:auto;
  background:#2563eb;
  color:#fff;
}
.bot{
  background:#fff;
}

/* INPUT BAR */
.input-bar{
  padding:12px;
  display:flex;
  gap:8px;
  background:#fff;
  align-items:center;
}
.input-bar input{
  flex:1;
  padding:12px;
  border-radius:20px;
  border:1px solid #ccc;
}
.input-bar button{
  width:44px;
  height:44px;
  border-radius:50%;
  border:none;
  background:#2563eb;
  color:#fff;
  cursor:pointer;
}
</style>
</head>

<body>

<!-- ---------- LOGIN ---------- -->
<div id="login">
  <div class="login-box">
    <h2>ðŸ¤– AI Login</h2>
    <input id="username" placeholder="Enter username">
    <button onclick="doLogin()">Login</button>
  </div>
</div>

<!-- ---------- CHAT ---------- -->
<div id="chat">

  <!-- SIDEBAR -->
  <div class="sidebar">
    <h3>ðŸ’¬ History</h3>
    <div id="history"></div>
    <button class="clear-btn" onclick="clearHistory()">ðŸ—‘ Clear History</button>
  </div>

  <!-- CHAT APP -->
  <div class="chat-app">

    <div class="header">
      <div class="header-title">ðŸ¤– TanujaNikitha AI</div>
      <button class="logout-btn" onclick="logout()">Logout</button>
    </div>

    <div id="chat-box"></div>

    <div class="input-bar">
      <input id="user-input" placeholder="Ask anything..."
        onkeydown="if(event.key==='Enter')sendMessage()">
      <button onclick="sendMessage()">âž¤</button>
      <input type="file" id="file" hidden onchange="uploadFile()">
      <button onclick="file.click()">ðŸ“‚</button>
      <button onclick="startVoice()">ðŸŽ¤</button>
    </div>

  </div>
</div>

<script>
const API="http://44.220.92.154:8080";

const loginDiv=document.getElementById("login");
const chatDiv=document.getElementById("chat");
const chatBox=document.getElementById("chat-box");
const historyDiv=document.getElementById("history");
const userInput=document.getElementById("user-input");

document.addEventListener("DOMContentLoaded",checkAuth);

/* ---------- AUTH ---------- */
function checkAuth(){
  const u=localStorage.getItem("username");
  loginDiv.style.display=u?"none":"flex";
  chatDiv.style.display=u?"flex":"none";
  if(u) loadHistory();
}

async function doLogin(){
  if(!username.value) return;
  await fetch(API+"/login",{method:"POST"});
  localStorage.setItem("username",username.value);
  checkAuth();
}

function logout(){
  localStorage.clear();
  location.reload();
}

/* ---------- UI HELPERS ---------- */
function append(text,type){
  const d=document.createElement("div");
  d.className="message "+type;
  d.textContent=text;
  chatBox.appendChild(d);
  chatBox.scrollTop=chatBox.scrollHeight;
}

function addToSidebar(text){
  const d=document.createElement("div");
  d.className="history-item";
  d.textContent=text;
  historyDiv.prepend(d); // newest on top
}

/* ---------- SEND MESSAGE ---------- */
async function sendMessage(){
  const msg=userInput.value.trim();
  if(!msg) return;

  append(msg,"user");
  addToSidebar(msg); // ðŸ”¥ INSTANT SIDEBAR UPDATE
  userInput.value="";

  const bot=document.createElement("div");
  bot.className="message bot";
  chatBox.appendChild(bot);

  const r=await fetch(API+"/chat-stream",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      message:msg,
      username:localStorage.getItem("username")
    })
  });

  const reader=r.body.getReader();
  const decoder=new TextDecoder();

  while(true){
    const {value,done}=await reader.read();
    if(done) break;
    bot.textContent+=decoder.decode(value);
    chatBox.scrollTop=chatBox.scrollHeight;
  }
}

/* ---------- LOAD HISTORY ---------- */
async function loadHistory(){
  const user=localStorage.getItem("username");
  if(!user) return;

  const r=await fetch(API+"/history?user="+user);
  const data=await r.json();

  historyDiv.innerHTML="";
  chatBox.innerHTML="";

  data.reverse().forEach(m=>{
    if(m.role==="user"){
      addToSidebar(m.message);
    }
    append(m.message, m.role==="user"?"user":"bot");
  });
}

/* ---------- FILE UPLOAD ---------- */
async function uploadFile(){
  const fd=new FormData();
  fd.append("file",file.files[0]);
  fd.append("username",localStorage.getItem("username"));
  const r=await fetch(API+"/upload",{method:"POST",body:fd});
  const d=await r.json();
  append(d.response,"bot");
}

/* ---------- CLEAR ---------- */
async function clearHistory(){
  await fetch(API+"/clear-history",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({username:localStorage.getItem("username")})
  });
  historyDiv.innerHTML="";
  chatBox.innerHTML="";
}

/* ---------- VOICE ---------- */
function startVoice(){
  if(!('webkitSpeechRecognition'in window)){
    alert("Voice not supported");
    return;
  }
  const rec=new webkitSpeechRecognition();
  rec.lang="en-US";
  rec.onresult=e=>{
    userInput.value=e.results[0][0].transcript;
  };
  rec.start();
}
</script>

</body>
</html>

